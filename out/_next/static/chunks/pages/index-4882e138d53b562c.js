(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(2576)}])},2576:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return pages}});var r=n(5893),a=n(7294),c=n(5582),i=n(5861),o=n(6836),l=n(5071),d=n(1845),u=n(5819),components_CameraComponent=e=>{let{onCapture:t}=e,[n,c]=(0,a.useState)([]),[i,o]=(0,a.useState)(null),l=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let getDevices=async()=>{let e=await navigator.mediaDevices.enumerateDevices(),t=e.filter(e=>"videoinput"===e.kind);c(t)};getDevices()},[]),(0,a.useEffect)(()=>{if(!l.current||!i)return;let e=l.current;return navigator.mediaDevices.getUserMedia({video:{deviceId:i},audio:!1}).then(t=>{e.srcObject=t,e.play()}).catch(e=>{console.log(e)}),()=>{e.srcObject&&e.srcObject.getTracks().forEach(e=>e.stop())}},[i]),(0,r.jsxs)("div",{children:[(0,r.jsx)("video",{ref:l,width:"640",height:"480"}),(0,r.jsx)("button",{onClick:()=>{var e,n;let r=document.createElement("canvas");r.width=(null===(e=l.current)||void 0===e?void 0:e.videoWidth)||0,r.height=(null===(n=l.current)||void 0===n?void 0:n.videoHeight)||0;let a=r.getContext("2d");null==a||a.drawImage(l.current,0,0);let c=r.toDataURL("image/png");null==t||t(c)},children:"この街景色を記録する！"}),(0,r.jsxs)(d.Z,{value:i||"",onChange:e=>o(e.target.value),children:[(0,r.jsx)(u.Z,{value:"",children:(0,r.jsx)("em",{children:"カメラを選択"})}),n.map(e=>(0,r.jsx)(u.Z,{value:e.deviceId,children:e.label},e.deviceId))]})]})},pages=()=>{let[e,t]=(0,a.useState)([]),[n,d]=(0,a.useState)(!1),handleCapture=e=>{t(t=>{let n=[...t,e];return n.length>8&&n.shift(),n}),n&&downloadImage(e)},downloadImage=e=>{let t=document.createElement("a");t.href=e,t.download="screenshot-".concat(Date.now(),".png"),t.click()},debounce=(e,t)=>{let n;var r=void 0;return function(){for(var a=arguments.length,c=Array(a),i=0;i<a;i++)c[i]=arguments[i];clearTimeout(n),n=setTimeout(()=>{e.apply(r,c)},t)}};return(0,a.useEffect)(()=>{let e=debounce(e=>{"Space"===e.code&&handleCapture("")},300);return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[]),(0,r.jsxs)(c.Z,{children:[(0,r.jsx)(i.Z,{variant:"h4",gutterBottom:!0,children:"CityCamera Project"}),(0,r.jsx)(components_CameraComponent,{onCapture:handleCapture}),(0,r.jsx)(o.Z,{control:(0,r.jsx)(l.Z,{checked:n,onChange:e=>d(e.target.checked),color:"primary"}),label:"街景色を自動的に保存"}),(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Z,{variant:"h6",gutterBottom:!0,children:"みんなの街景色："}),e.map((e,t)=>e?(0,r.jsx)("img",{src:e,alt:"スクリーンショット ".concat(t+1),style:{width:"240px",margin:"10px"}},t):null)]})]})}}},function(e){e.O(0,[774,671,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);